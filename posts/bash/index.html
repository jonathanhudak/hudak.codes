<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>hudak.codes - Automating repo setup for TypeScript, Prettier, Eslint, Husky, and Commitizen with Bash 💥</title>
   <link rel="stylesheet" href="https://unpkg.com/missing.css@1.1.1">
    <link rel="stylesheet" href="https://unpkg.com/missingprism.css@1.1.1">
  <link rel="stylesheet" href="/style.css">
</head>
<body>
  <main>
    <article>
      <header>
        <a href="/">hudak.codes</a>
      </header>

      
        <h1>Automating repo setup for TypeScript, Prettier, Eslint, Husky, and Commitizen with Bash 💥</h1>
        <strong>2022-10-02</strong>
      

      <p>I have recently rekindled a love with bash scripts to automate repetitive tasks.
They may look a bit ugly but you can hack together something useful quite easily.</p>
<p>One thing I have found to be a pain recently is setting up linting, prettier, and commitizen in npm (NodeJS) packages. So as an exercise I took a stab at automating the whole process as outlined in this unaffiliated blog post <a href="https://jamesandrewwright.com/articles/commitizen-eslint-prettier-husky">https://jamesandrewwright.com/articles/commitizen-eslint-prettier-husky</a></p>
<p>Here is the script:
<a href="https://gist.github.com/jonathanhudak/96600bce4540cb7bf29a4b9211bebbc5">https://gist.github.com/jonathanhudak/96600bce4540cb7bf29a4b9211bebbc5</a></p>
<pre class="language-bash" tabindex="0"><code class="language-bash"><span class="token function-name function">step</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$1</span>? "</span> <span class="token parameter variable">-r</span>
    <span class="token builtin class-name">echo</span>    <span class="token comment"># (optional) move to a new line</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token environment constant">$REPLY</span> <span class="token operator">=~</span> ^<span class="token punctuation">[</span>Yy<span class="token punctuation">]</span>$ <span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span> <span class="token string">"[Running]: <span class="token variable">$2</span>"</span>
        <span class="token builtin class-name">eval</span> <span class="token string">"<span class="token variable">$2</span>"</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">stepWithFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$1</span>? "</span> <span class="token parameter variable">-r</span>
    <span class="token builtin class-name">echo</span>    <span class="token comment"># (optional) move to a new line</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token environment constant">$REPLY</span> <span class="token operator">=~</span> ^<span class="token punctuation">[</span>Yy<span class="token punctuation">]</span>$ <span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">then</span>
        <span class="token punctuation">(</span><span class="token variable">$2</span><span class="token punctuation">)</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">stepWithInput</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$1</span>? "</span> <span class="token parameter variable">-r</span>
    <span class="token builtin class-name">echo</span>    <span class="token comment"># (optional) move to a new line</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token environment constant">$REPLY</span> <span class="token operator">=~</span> ^<span class="token punctuation">[</span>Yy<span class="token punctuation">]</span>$ <span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">then</span>
        <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"<span class="token variable">$2</span> "</span> <span class="token parameter variable">-r</span>
        <span class="token builtin class-name">echo</span>    <span class="token comment"># (optional) move to a new line</span>
        <span class="token punctuation">(</span><span class="token variable">$3</span> <span class="token environment constant">$REPLY</span><span class="token punctuation">)</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token function-name function">manualStep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token variable">$@</span>"</span>
    <span class="token builtin class-name">read</span> <span class="token parameter variable">-p</span> <span class="token string">"Are you done? "</span> <span class="token parameter variable">-r</span>
    <span class="token builtin class-name">echo</span>    <span class="token comment"># (optional) move to a new line</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token environment constant">$REPLY</span> <span class="token operator">=~</span> ^<span class="token punctuation">[</span>Yy<span class="token punctuation">]</span>$ <span class="token punctuation">]</span><span class="token punctuation">]</span>
    <span class="token keyword">then</span>
        <span class="token builtin class-name">echo</span>
    <span class="token keyword">fi</span>
<span class="token punctuation">}</span>

<span class="token comment"># --- BEGIN</span>

step <span class="token punctuation">\</span>
    <span class="token string">"Initialize git repo"</span> <span class="token punctuation">\</span>
    <span class="token string">"git init"</span> <span class="token punctuation">\</span>

<span class="token comment"># setup typescript</span>

step <span class="token punctuation">\</span>
    <span class="token string">"Setup typescript"</span> <span class="token punctuation">\</span>
    <span class="token string">"npm install typescript --save-dev &amp;&amp; npx tsc --init"</span> <span class="token punctuation">\</span>

<span class="token comment"># ---</span>

<span class="token comment"># Prettier and ESLint</span>

step <span class="token punctuation">\</span>
    <span class="token string">"Install Prettier and ESLint node modules from npm"</span> <span class="token punctuation">\</span>
    <span class="token string">"npm install eslint prettier eslint-config-prettier  --save-dev"</span>

step <span class="token punctuation">\</span>
    <span class="token string">"Create ESLint configuration file"</span> <span class="token punctuation">\</span>
    <span class="token string">"npm init @eslint/config"</span>

step <span class="token punctuation">\</span>
    <span class="token string">"Create ESLint ignore file"</span> <span class="token punctuation">\</span>
    <span class="token string">"echo .eslintrc.js &gt;&gt; .eslintignore"</span>

step <span class="token punctuation">\</span>
    <span class="token string">"Create .prettierrc"</span> <span class="token punctuation">\</span>
    <span class="token string">"echo -e '{<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span><span class="token entity" title="\&quot;">\"</span>tabWidth<span class="token entity" title="\&quot;">\"</span>: 4<span class="token entity" title="\n">\n</span>}' &gt;&gt; .prettierrc"</span>

step <span class="token punctuation">\</span>
    <span class="token string">"Create .prettierignore"</span> <span class="token punctuation">\</span>
    <span class="token string">"echo -e '# Ignore artifacts:<span class="token entity" title="\n">\n</span>package-lock.json<span class="token entity" title="\n">\n</span>build<span class="token entity" title="\n">\n</span>coverage' &gt;&gt; .prettierignore"</span>

manualStep <span class="token punctuation">\</span>
    <span class="token string">"Add <span class="token entity" title="\&quot;">\"</span>prettier<span class="token entity" title="\&quot;">\"</span> to eslint config <span class="token entity" title="\&quot;">\"</span>extends<span class="token entity" title="\&quot;">\"</span><span class="token entity" title="\n">\n</span>"</span> <span class="token punctuation">\</span>
    <span class="token string">'\nExample:\n\t"extends": ["eslint:recommended", "prettier"],\n'</span>

<span class="token function-name function">checkRules</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token builtin class-name">eval</span> <span class="token string">"npx eslint-config-prettier <span class="token variable">$1</span>"</span> <span class="token punctuation">;</span>
<span class="token punctuation">}</span>

stepWithInput <span class="token punctuation">\</span>
    <span class="token string">"Run npx eslint-config-prettier"</span> <span class="token punctuation">\</span>
    <span class="token string">"Provide a path to your files:"</span> <span class="token punctuation">\</span>
    checkRules

<span class="token comment"># Testing ESLint and Prettier</span>

<span class="token function-name function">testESLintPrettier</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token assign-left variable">p</span><span class="token operator">=</span><span class="token variable">${1<span class="token operator">:-</span>"."}</span>
    <span class="token builtin class-name">eval</span> <span class="token string">"npx eslint . <span class="token variable">$p</span>"</span>
    <span class="token builtin class-name">eval</span> <span class="token string">"npx prettier --check . <span class="token variable">$p</span>"</span>
    <span class="token builtin class-name">eval</span> <span class="token string">"npx prettier --write . <span class="token variable">$p</span>"</span>
<span class="token punctuation">}</span>

stepWithInput <span class="token punctuation">\</span>
    <span class="token string">"Test eslint and prettier"</span> <span class="token punctuation">\</span>
    <span class="token string">"Provide a path - [Press Enter] for default (.):"</span> <span class="token punctuation">\</span>
    testESLintPrettier



<span class="token comment"># Adding helper scripts to package.json</span>
<span class="token comment"># https://docs.npmjs.com/cli/v7/commands/npm-pkg</span>

step <span class="token punctuation">\</span>
    <span class="token string">'Add "prettier:check" script to package.json'</span> <span class="token punctuation">\</span>
    <span class="token string">"npm pkg set 'scripts.prettier:check'='npx prettier --check .'"</span>

step <span class="token punctuation">\</span>
    <span class="token string">'Add "prettier:fix" script to package.json'</span> <span class="token punctuation">\</span>
    <span class="token string">"npm pkg set 'scripts.prettier:fix'='npx prettier --write .'"</span>

step <span class="token punctuation">\</span>
    <span class="token string">'Add "lint" script to package.json'</span> <span class="token punctuation">\</span>
    <span class="token string">"npm pkg set 'scripts.lint'='npx eslint .'"</span>

<span class="token comment"># ---</span>

<span class="token comment"># Add extensions to VSCode (optional)</span>

<span class="token function-name function">addExtensions</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> .vscode
    <span class="token function">cat</span> <span class="token operator">&gt;</span>.vscode/extensions.json <span class="token operator">&lt;&lt;</span><span class="token string">EOL
{
  "recommendations": [
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode"
  ]
}
EOL</span>
<span class="token punctuation">}</span>
stepWithFn <span class="token punctuation">\</span>
    <span class="token string">"Add recommended .vscode/extensions.json"</span> <span class="token punctuation">\</span>
    addExtensions

<span class="token comment">#TODO</span>
<span class="token comment"># husky</span>

step <span class="token punctuation">\</span>
    <span class="token string">"Setup and install Husky to configure git hooks"</span> <span class="token punctuation">\</span>
    <span class="token string">"npx husky-init &amp;&amp; npm install  --save-dev"</span>

<span class="token comment"># lint-staged</span>
step <span class="token punctuation">\</span>
    <span class="token string">"Setup and install <span class="token entity" title="\&quot;">\"</span>lint-staged<span class="token entity" title="\&quot;">\"</span> to limit linting to staged files"</span> <span class="token punctuation">\</span>
    <span class="token string">"npm install lint-staged --save-dev"</span>

<span class="token function-name function">addLintStagedConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">npm</span> pkg <span class="token builtin class-name">set</span> <span class="token string">'lint-staged[*.{css,html,json,jsx,js,ts,tsx}][0]=prettier --write'</span>
    <span class="token function">npm</span> pkg <span class="token builtin class-name">set</span> <span class="token string">'lint-staged[*.{js,jsx,ts,tsx}][0]=eslint --fix'</span>
<span class="token punctuation">}</span>

stepWithFn <span class="token punctuation">\</span>
    <span class="token string">'Add "lint-staged" config to package.json'</span> <span class="token punctuation">\</span>
    addLintStagedConfig

<span class="token function-name function">updateHuskyPreCommit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> <span class="token string">"<span class="token environment constant">$PWD</span>/.husky/pre-commit"</span></span>
#!/bin/sh
. "\<span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> <span class="token string">"\<span class="token variable">$0</span>"</span><span class="token variable">)</span></span>/_/husky.sh"
npx lint-staged
EOF</span>
<span class="token punctuation">}</span>

stepWithFn <span class="token punctuation">\</span>
    <span class="token string">"Update .husky/pre-commit"</span>
    updateHuskyPreCommit

<span class="token comment">#  Commitizen and friends</span>


<span class="token function-name function">installCommitizen</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">npm</span> <span class="token function">install</span> commitizen cz-conventional-changelog @commitlint/cli @commitlint/config-conventional --save-dev
    <span class="token function">npm</span> pkg <span class="token builtin class-name">set</span> <span class="token string">'scripts.commitizen:init'</span><span class="token operator">=</span><span class="token string">'commitizen init cz-conventional-changelog --save-dev --save-exact'</span>
    <span class="token function">npm</span> run commitizen:init
<span class="token punctuation">}</span>

stepWithFn <span class="token punctuation">\</span>
    <span class="token string">"Install Commitizen, cz-conventional-changelog lint-staged and @commitlint"</span>
    installCommitizen

<span class="token function-name function">addCommitLintConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> <span class="token string">"<span class="token environment constant">$PWD</span>/commitlint.config.js"</span></span>
module.exports = { extends: ["@commitlint/config-conventional"] };
EOF</span>
<span class="token punctuation">}</span>

stepWithFn <span class="token punctuation">\</span>
    <span class="token string">"Create commitlint.config.js"</span> <span class="token punctuation">\</span>
   addCommitLintConfig

<span class="token comment"># .husky/prepare-commit-msg</span>

<span class="token function-name function">updateHuskyPrepareCommitMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> <span class="token string">"<span class="token environment constant">$PWD</span>/.husky/prepare-commit-msg"</span></span>
#!/bin/sh
. "\<span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> <span class="token string">"\<span class="token variable">$0</span>"</span><span class="token variable">)</span></span>/_/husky.sh"
exec &lt; /dev/tty &amp;&amp; node_modules/.bin/cz --hook || true
EOF</span>
<span class="token punctuation">}</span>

stepWithFn <span class="token punctuation">\</span>
    <span class="token string">"Update .husky/prepare-commit-msg"</span>
    updateHuskyPrepareCommitMessage


<span class="token comment"># .husky/commit-msg</span>

<span class="token function-name function">updateHuskyCommitMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span> <span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> <span class="token string">"<span class="token environment constant">$PWD</span>/.husky/commit-msg"</span></span>
#!/bin/sh
. "\<span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> <span class="token string">"\<span class="token variable">$0</span>"</span><span class="token variable">)</span></span>/_/husky.sh"
npx commitlint --edit <span class="token variable">$1</span>
EOF</span>
<span class="token punctuation">}</span>

stepWithFn <span class="token punctuation">\</span>
    <span class="token string">"Update .husky/commit-msg"</span>
    updateHuskyCommitMessage

<span class="token function-name function">makeHuskyExec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">chmod</span> +x <span class="token string">"<span class="token environment constant">$PWD</span>/./husky/*"</span>
<span class="token punctuation">}</span>

<span class="token function-name function">makeHuskyExec</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">chmod</span> +x <span class="token string">"<span class="token environment constant">$PWD</span>/.husky/commit-msg"</span>
    <span class="token function">chmod</span> +x <span class="token string">"<span class="token environment constant">$PWD</span>/.husky/pre-commit"</span>
    <span class="token function">chmod</span> +x <span class="token string">"<span class="token environment constant">$PWD</span>/.husky/prepare-commit-msg"</span>
<span class="token punctuation">}</span>

stepWithFn <span class="token punctuation">\</span>
    <span class="token string">"Make .husky scripts executable"</span> <span class="token punctuation">\</span>
    makeHuskyExec


<span class="token builtin class-name">echo</span> <span class="token parameter variable">-e</span> <span class="token string">"<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>All done! Test with:<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>git add .<span class="token entity" title="\n">\n</span><span class="token entity" title="\t">\t</span>git commit -m <span class="token entity" title="\&quot;">\"</span>I am a cowboy<span class="token entity" title="\&quot;">\"</span><span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>"</span>
</code></pre>
<h2>Run gist from <a href="https://ohmyz.sh/">Zsh</a></h2>
<p>I also created an function for my local Zsh config file that allows me to easily run bash script from a github gist.</p>
<p>⛔️ Note this should be used with caution ⛔️</p>
<p><a href="https://gist.github.com/jonathanhudak/5b9ff8a3e988204be74b80a6004a5e85">https://gist.github.com/jonathanhudak/5b9ff8a3e988204be74b80a6004a5e85</a></p>
<h2>Setup a Node package with all the bells and whistles of modern frontend development</h2>
<p>Check it out below. If you trust it you can add the function above and then start it up like so:</p>
<p><a href="https://gist.github.com/jonathanhudak/96600bce4540cb7bf29a4b9211bebbc5">https://gist.github.com/jonathanhudak/96600bce4540cb7bf29a4b9211bebbc5</a></p>
    </article>
  </main>
  <footer class="footer">
    <a href="https://jonathanhudak.com">Jonathan Hudak © 2023</a>
    <a href="https://github.com/jonathanhudak">Github</a>
    <a href="https://twitter.com/hudak_jonathan">Twitter</a>
    <a href="https://www.linkedin.com/in/jonathan-hudak-084a529/">LinkedIn</a>
  </footer>

</body></html>